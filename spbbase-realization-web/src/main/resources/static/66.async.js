(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[66],{PXWt:function(e,t,a){"use strict";var l=a("xK3H"),n=a("3rQ3");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fhlT");var r=l(a("kXZy"));a("/26P");var i=l(a("aYvq"));a("Lzml");var d=l(a("vpm+"));a("mKhK");var o=l(a("iW5v"));a("Ktq0");var u=l(a("fL5V")),s=l(a("aG3W")),c=l(a("8g53"));a("GvWx");var f=l(a("MSoP")),p=l(a("SeLb")),m=l(a("dnxz")),h=l(a("Sx57")),v=l(a("4zp0")),y=l(a("iVWQ")),g=l(a("lF+r")),w=l(a("PApH")),b=l(a("+S5U"));a("Q3sr");var E=l(a("9NP+"));a("/MhY");var k=l(a("w0+5"));a("E2ON");var C=l(a("jjSt"));a("XFd2");var I,S,R,F,O,N=l(a("33fr")),x=n(a("zLBQ")),P=a("LneV"),V=l(a("zHco")),A=l(a("CkN6")),L=l(a("0Wp1")),M=N.default.confirm,T=C.default.Option,D=k.default.TextArea,q=E.default.Item,j=[{key:0,value:"\u6743\u9650\u7c7b\u578b"},{key:1,value:"\u6743\u9650\u7c7b\u578b1"},{key:2,value:"\u6743\u9650\u7c7b\u578b2"},{key:3,value:"\u6743\u9650\u7c7b\u578b3"}],J=x.default.createContext(),W=function(e){var t=e.form,a=(e.index,(0,b.default)(e,["form","index"]));return x.default.createElement(J.Provider,{value:t},x.default.createElement("tr",a))},z=E.default.create()(W),K=function(e){function t(){var e,a;(0,h.default)(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=(0,y.default)(this,(e=(0,g.default)(t)).call.apply(e,[this].concat(n))),a.state={editing:!1},a.handleClickOutside=function(e){var t=a.state.editing;t&&a.cell!==e.target&&!a.cell.contains(e.target)&&a.save()},a}return(0,w.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){this.props.editable&&document.addEventListener("click",this.handleClickOutside,!0)}},{key:"componentWillUnmount",value:function(){this.props.editable&&document.removeEventListener("click",this.handleClickOutside,!0)}},{key:"render",value:function(){var e=this,t=this.state.editing,a=this.props,l=a.editable,n=a.dataIndex,r=a.title,i=a.record,d=(0,b.default)(a,["editable","dataIndex","title","record"]);return x.default.createElement("td",(0,m.default)({ref:function(t){return e.cell=t}},d),l?x.default.createElement(J.Consumer,null,function(a){return e.form=a,t?x.default.createElement(q,{style:{margin:0}},a.getFieldDecorator(n,{rules:[{required:!0,message:"".concat(r," is required.")}],initialValue:i[n]})(x.default.createElement(k.default,{ref:function(t){return e.input=t},onPressEnter:e.save}))):x.default.createElement("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:e.toggleEdit},d.children)}):d.children)}}]),t}(x.default.Component),H=(I=E.default.create(),I(S=function(e){function t(){var e,a;(0,h.default)(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=(0,y.default)(this,(e=(0,g.default)(t)).call.apply(e,[this].concat(n))),a.onOk=function(){var e=a.props,t=e.form,l=e.handleOk;t.validateFields(function(e,n){if(!e){var r=(0,p.default)({},n);a.setState(function(){l(r)}),t.resetFields()}})},a.onCancel=function(){var e=a.props,t=e.form,l=e.handleCancel;a.setState(function(){l()}),t.resetFields()},a.onchange=function(e,t){var l=a.props.onchange;a.setState(function(){l(t[t.length-1])})},a}return(0,w.default)(t,e),(0,v.default)(t,[{key:"render",value:function(){var e=this.props,t=e.form,a=e.areaModalVisible,l=e.action,n=e.selectRow,r=e.dataList,i=e.type,d=function(){if(null!==r){var e=JSON.parse(JSON.stringify(r)),t={},a=[];for(var l in e)e[l].key=l-1,e[l].value=e[l].id,e[l].title=e[l].name,t[e[l].id]=e[l];for(var n in t)t[n].parentId&&t[t[n].parentId]?(null===t[t[n].parentId]||t[t[n].parentId].children||(t[t[n].parentId].children=new Array),t[t[n].parentId].children.push(t[n])):a.push(t[n]);return a}};return x.default.createElement(N.default,{title:"".concat(l,"\u4fe1\u606f"),visible:a,onOk:this.onOk,onCancel:this.onCancel},x.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u6743\u9650\u7f16\u7801"},t.getFieldDecorator("code",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6743\u9650\u7f16\u7801\uff01"}],initialValue:n.code})(x.default.createElement(k.default,{placeholder:"\u8bf7\u8f93\u5165\u6743\u9650\u7f16\u7801"}))),x.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u6743\u9650\u540d\u79f0"},t.getFieldDecorator("name",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6743\u9650\u540d\u79f0\uff01"}],initialValue:n.name})(x.default.createElement(k.default,{placeholder:"\u8bf7\u8f93\u5165\u6743\u9650\u540d\u79f0"}))),x.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u4e0a\u7ea7\u6743\u9650"},t.getFieldDecorator("parentId",{initialValue:parseInt(n.parentId,10)===parseInt(0,10)?"":n.parentId})(x.default.createElement(f.default,{disabled:1===n.isEdit,style:{width:300},dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:d(JSON.stringify(r)),placeholder:"\u4e0a\u7ea7\u6743\u9650"}))),x.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u6743\u9650\u7c7b\u578b"},t.getFieldDecorator("type",{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6743\u9650\u7c7b\u578b\uff01"}],initialValue:n.type})(x.default.createElement(C.default,{placeholder:"\u8bf7\u9009\u62e9\u6743\u9650\u7c7b\u578b",style:{width:"100%"}},j.map(function(e){return x.default.createElement(T,{key:e.key,value:e.key},e.value)})))),x.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u6392\u5e8f\u53f7"},t.getFieldDecorator("treeSort",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6392\u5e8f\u53f7\uff01"}],initialValue:"\u6392\u5e8f\u53f7"===l?i:n.treeSort})(x.default.createElement(k.default,{placeholder:"\u8bf7\u8f93\u5165\u6392\u5e8f\u53f7"}))),x.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"\u6743\u9650\u63cf\u8ff0"},t.getFieldDecorator("description",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6743\u9650\u63cf\u8ff0\uff01"}],initialValue:"\u6743\u9650\u63cf\u8ff0"===l?i:n.description})(x.default.createElement(D,{placeholder:"\u6743\u9650\u63cf\u8ff0",autosize:{minRows:4,maxRows:8}}))))}}]),t}(x.PureComponent))||S),Q=(R=(0,P.connect)(function(e){var t=e.privilege,a=e.loading;return{privilege:t,loading:a.models.privilege}}),F=E.default.create(),R(O=F(O=function(e){function t(){var e,a;(0,h.default)(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=(0,y.default)(this,(e=(0,g.default)(t)).call.apply(e,[this].concat(n))),a.state={selectRow:{},selectedRows:[],areaModalVisible:!1,action:"",treeNames:"",type:""},a.buildTree=function(e,t){if(null!==e){var a=(0,s.default)(Array.from(new Set(JSON.parse(e)))),l={},n=[];for(var r in a)1===a[r].treeLeaf&&(a[r].children=new Array),l[a[r].id]=a[r];for(var i in l)l[i].parentId&&l[l[i].parentId]?(null===l[l[i].parentId]||l[l[i].parentId].children||(l[l[i].parentId].children=new Array),l[l[i].parentId].children.push(l[i])):n.push(l[i]);var d={list:n,total:t};return d}},a.handleSearch=function(e){e.preventDefault();var t=a.props,l=t.dispatch,n=t.form;n.validateFields(function(e,t){if(!e){var a={type:""===t.type?void 0:t.type,name:""===t.name?void 0:t.name};void 0===a.type&&void 0===a.name?l({type:"privilege/fetch",payload:{parentId:0}}):l({type:"privilege/fetchPrivilege"})}})},a.handleFormReset=function(){var e=a.props,t=e.form,l=e.dispatch;t.resetFields(),l({type:"privilege/fetch",payload:{parentId:0}}),l({type:"privilege/fetchPrivilege"})},a.buildTreeTest=function(e){if(null!==e){var t=(0,s.default)(Array.from(new Set(JSON.parse(e)))),a={},l=[];for(var n in t)a[t[n].code]=t[n];for(var r in a)a[r].parentId&&a[a[r].parentId]?(null===a[a[r].parentId]||a[a[r].parentId].children||(a[a[r].parentId].children=new Array),a[a[r].parentId].children.push(a[r])):l.push(a[r]);return l}},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a.showAreaModal=function(e,t){var l=a.state.selectedRows;if("\u4fee\u6539"===t){var n=l[0].treeNames.split("/");n.pop();var r=l[0].parentIds.split(",");r.shift();var i=(0,p.default)({},l[0],{selectTreeNames:r,treeNames:n.join("/"),isEdit:1});a.setState({action:t,selectRow:i})}if("\u6dfb\u52a0\u4e0b\u7ea7"===t){var d=l[0].parentIds+","+l[0].id,o=d.split(",");o.shift();var u={selectTreeNames:o,parentId:l[0].id};a.setState({action:t,selectRow:u})}"\u65b0\u589e\u6743\u9650"===t&&a.setState({action:t,selectRow:{}}),a.setState({areaModalVisible:!0})},a.remove=function(){var e=(0,c.default)((0,c.default)(a)),t=a.props.dispatch,l=a.state.selectedRows,n=l.map(function(e){return e.id});M({title:"\u786e\u5b9a\u8981\u5220\u9664\u8be5\u6743\u9650\u53ca\u5176\u4e0b\u7ea7\u6743\u9650?",onOk:function(){new Promise(function(e,a){t({type:"privilege/remove",payload:{ids:n,resolve:e,reject:a}})}).then(function(t){null!==t&&(e.handleFormReset(),u.default.success("\u5220\u9664\u6210\u529f"),e.setState({selectedRows:[]}))})},onCancel:function(){}})},a.handleOk=function(e){var t=a.props,l=t.dispatch,n=t.form,r=a.state.action,i=a.state.selectedRows,d=(0,c.default)((0,c.default)(a));n.validateFields(function(t,a){if(!t){if("\u4fee\u6539"===r){var n=(0,p.default)({},e,{id:i[0].id});new Promise(function(e,t){l({type:"privilege/update",payload:(0,p.default)({},n,{resolve:e,reject:t})})}).then(function(e){null!==e&&(d.setState({selectedRows:[]}),d.handleFormReset(),u.default.success("\u4fee\u6539\u6210\u529f"))})}"\u6dfb\u52a0\u4e0b\u7ea7"===r&&new Promise(function(t,a){l({type:"privilege/add",payload:(0,p.default)({},e,{resolve:t,reject:a})})}).then(function(e){null!==e&&(u.default.success("\u6dfb\u52a0\u6210\u529f"),d.handleFormReset())}),"\u65b0\u589e\u6743\u9650"===r&&new Promise(function(t,a){l({type:"privilege/add",payload:(0,p.default)({},e,{resolve:t,reject:a})})}).then(function(e){null!==e&&(u.default.success("\u6dfb\u52a0\u6210\u529f"),d.handleFormReset())})}}),d.setState({selectRow:{},selectedRows:[],areaModalVisible:!1})},a.handleCancel=function(){a.setState({areaModalVisible:!1,selectRow:{}})},a}return(0,w.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e({type:"privilege/fetch",payload:{parentId:0}}),e({type:"privilege/fetchPrivilege"})}},{key:"renderAdvancedForm",value:function(){var e=this.props.form.getFieldDecorator;return x.default.createElement(E.default,{onSubmit:this.handleSearch,layout:"inline"},x.default.createElement(i.default,{gutter:{md:8,lg:24,xl:48}},x.default.createElement(o.default,{md:8,sm:24},x.default.createElement(q,{label:"\u6743\u9650\u540d\u79f0"},e("name")(x.default.createElement(k.default,{placeholder:"\u8bf7\u8f93\u5165\u6743\u9650\u540d\u79f0"})))),x.default.createElement(o.default,{md:8,sm:24},x.default.createElement(q,{label:"\u6743\u9650\u7c7b\u578b"},e("type")(x.default.createElement(C.default,{allowClear:!0,placeholder:"\u8bf7\u9009\u62e9\u6743\u9650\u7c7b\u578b",style:{width:"100%"}},j.map(function(e){return x.default.createElement(T,{key:e.key},e.value)}))))),x.default.createElement(o.default,{md:8,sm:24},x.default.createElement(d.default,{type:"primary",htmlType:"submit"},"\u67e5\u8be2"),x.default.createElement(d.default,{style:{marginLeft:8},onClick:this.handleFormReset},"\u91cd\u7f6e"))))}},{key:"render",value:function(){var e=this,t=this.props,a=t.privilege,l=a.data,n=a.dataList,i=t.dispatch,o=[{title:"\u6743\u9650\u7f16\u53f7",align:"center",dataIndex:"code",width:"20%"},{title:"\u6743\u9650\u540d\u79f0",align:"center",dataIndex:"name",width:"20%"},{title:"\u6743\u9650\u7c7b\u578b",align:"center",dataIndex:"type",width:"23%"},{title:"\u6743\u9650\u63cf\u8ff0",dataIndex:"description",width:"23%"}],u={body:{row:z,cell:K}},s=o.map(function(e){return e.editable?(0,p.default)({},e,{onCell:function(t){return{record:t,editable:e.editable,dataIndex:e.dataIndex,title:e.title}}}):e}),c=this.state,f=c.selectedRows,h=c.areaModalVisible,v=c.action,y=c.selectRow,g=c.isRepetitive,w=c.treeNames,b=c.type,E={buildTree:this.buildTree,handleCancel:this.handleCancel,handleOk:this.handleOk,buildTreeTest:this.buildTreeTest,checkCode:this.checkCode,onchange:this.onchange,loadData:this.loadData};return void 0!==l&&void 0!==l.list?x.default.createElement(V.default,{title:"\u6743\u9650\u7ba1\u7406"},x.default.createElement(r.default,{bordered:!1},x.default.createElement("div",{className:L.default.tableList},x.default.createElement("div",{className:L.default.tableListForm},this.renderAdvancedForm()),x.default.createElement("div",{className:L.default.tableListOperator},x.default.createElement(d.default,{type:"primary",onClick:function(t){return e.showAreaModal(t,1===f.length?"\u6dfb\u52a0\u4e0b\u7ea7":"\u65b0\u589e\u6743\u9650")}},1===f.length?"\u6dfb\u52a0\u4e0b\u7ea7":"\u65b0\u589e\u6743\u9650"),x.default.createElement(d.default,{onClick:function(t){return e.showAreaModal(t,"\u4fee\u6539")},disabled:1!==f.length},"\u4fee\u6539"),x.default.createElement(d.default,{onClick:this.remove,disabled:!f.length>0},"\u5220\u9664"),x.default.createElement(H,(0,m.default)({},E,{selectRow:y,areaModalVisible:h,treeNames:w,type:b,action:v,isRepetitive:g,dataList:n,dispatch:i})))),x.default.createElement(A.default,{rowKey:"id",columns:s,components:u,selectedRows:f,data:this.buildTree(JSON.stringify(l.list),l.total),onSelectRow:this.handleSelectRows}))):null}}]),t}(x.PureComponent))||O)||O),X=Q;t.default=X}}]);