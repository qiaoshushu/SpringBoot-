(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[43],{jtHf:function(e,t,a){"use strict";var l=a("xK3H"),n=a("3rQ3");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(a("dnxz"));a("khen");var d=l(a("3J+T"));a("fhlT");var u=l(a("kXZy"));a("9TwZ");var s=l(a("wOVV"));a("1pPU");var i=l(a("KjZ1"));a("Lzml");var c=l(a("vpm+"));a("Ktq0");var o=l(a("fL5V")),f=l(a("8g53"));a("/26P");var m=l(a("aYvq"));a("mKhK");var p=l(a("iW5v")),h=l(a("SeLb")),v=l(a("Sx57")),E=l(a("4zp0")),y=l(a("iVWQ")),g=l(a("lF+r")),b=l(a("PApH"));a("Z2z2");var w=l(a("kI2X"));a("fjSA");var k=l(a("arrB"));a("XFd2");var S=l(a("33fr"));a("E2ON");var C=l(a("jjSt"));a("/MhY");var M=l(a("w0+5"));a("SwZr");var V=l(a("AUq8"));a("Q3sr");var I,F,x,R,N,D=l(a("9NP+")),O=n(a("zLBQ")),j=a("LneV"),L=l(a("r27q")),z=l(a("I9Uw")),P=(l(a("iczh")),l(a("+kNj"))),A=l(a("CkN6")),U=l(a("zHco")),Y=l(a("xzfs")),T=P.default.Description,q=D.default.Item,K=V.default.Step,B=M.default.TextArea,J=C.default.Option,Z=S.default.confirm,H=function(e){return Object.keys(e).map(function(t){return e[t]}).join(",")},Q=O.default.createElement("div",{style:{width:160}},"\u5434\u52a0\u53f7",O.default.createElement("span",{className:Y.default.textSecondary,style:{float:"right"}},O.default.createElement(k.default,{status:"default",text:O.default.createElement("span",{style:{color:"rgba(0, 0, 0, 0.45)"}},"\u672a\u54cd\u5e94")})),O.default.createElement("div",{className:Y.default.textSecondary,style:{marginTop:4}},"\u8017\u65f6\uff1a2\u5c0f\u65f625\u5206\u949f")),X=function(e,t){var a=t.status;return"process"===a?O.default.createElement(w.default,{placement:"topLeft",arrowPointAtCenter:!0,content:Q},e):e},_=(O.default.createElement("div",null,O.default.createElement("p",null,"\u4e0d\u901a\u8fc7\u539f\u56e0\uff1a\u6570\u636e\u6807\u672c\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u8fdb\u884c\u68c0\u6d4b")),I=D.default.create(),I(F=function(e){function t(e){var a;return(0,v.default)(this,t),a=(0,y.default)(this,(0,g.default)(t).call(this,e)),a.state={formVals:(0,h.default)({},e.values),currentStep:0},a.formLayout={labelCol:{span:7},wrapperCol:{span:13}},a}return(0,b.default)(t,e),(0,E.default)(t,[{key:"render",value:function(){var e=this.props,t=e.form,a=e.updateModalVisible,l=e.handleUpdateModalVisible,n=this.state,r=n.currentStep;n.formVals;return O.default.createElement(S.default,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:"\u5ba1\u6838\u4e0d\u901a\u8fc7\u539f\u56e0",visible:a,footer:this.renderFooter(r),onCancel:function(){return l()}},O.default.createElement(m.default,{gutter:16},O.default.createElement(p.default,{lg:24,md:24,sm:24},O.default.createElement(D.default.Item,null,t.getFieldDecorator("Reasons",{rules:[{required:!1,message:"\u8bf7\u5199\u5165\u539f\u56e0"}],initialValue:"\u8fd9\u662f\u5ba1\u6838\u4e0d\u901a\u8fc7\u7684\u539f\u56e0"})(O.default.createElement(B,{disabled:!0,autosize:{minRows:4,maxRows:8}}))))))}}]),t}(O.PureComponent))||F),W=(x=(0,j.connect)(function(e){var t=e.casedemo,a=e.caseform,l=e.Entrust,n=e.loading;return{casedemo:t,caseform:a,Entrust:l,loading:n.models.casedemo}}),R=D.default.create(),x(N=R(N=function(e){function t(){var e,a;(0,v.default)(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=(0,y.default)(this,(e=(0,g.default)(t)).call.apply(e,[this].concat(n))),a.state={modal1Visible:!1,updateModalVisible:!1,expandForm:!1,selectedRows:[],formValues:{},stepFormValues:{},visible:!1,stepDirection:"horizontal"},a.handleStandardTableChange=function(e,t,l){var n=a.props.dispatch,r=a.state.formValues,d=Object.keys(t).reduce(function(e,a){var l=(0,h.default)({},e);return l[a]=H(t[a]),l},{}),u=(0,h.default)({currentPage:e.current,pageSize:e.pageSize},r,d);l.field&&(u.sorter="".concat(l.field,"_").concat(l.order)),n({type:"casedemo/fetch",payload:u})},a.handleFormReset=function(){var e=a.props,t=e.form,l=e.dispatch;t.resetFields(),a.setState({formValues:{}}),l({type:"casedemo/fetch",payload:{}})},a.handleSearchs=function(){a.handleForm()},a.handleSearch=function(e){e.preventDefault(),a.handleForm()},a.handleForm=function(){var e=a.props,t=e.dispatch,l=e.form;l.validateFields(function(e,l){if(!e){var n=(0,h.default)({},l,{acceptDate:l.acceptDate&&l.acceptDate.format("YYYY-MM-DD")});a.setState({formValues:n}),t({type:"casedemo/fetch",payload:n})}})},a.toggleForm=function(){var e=a.state.expandForm;a.setState({expandForm:!e})},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a.handJump=function(e){L.default.push({pathname:"/case/advanced",state:{id:e.id}})},a.showModal=function(){var e=a.props.dispatch,t=a.state.selectedRows;new Promise(function(a,l){e({type:"casedemo/queryMaterials",payload:{ids:t.map(function(e){return e.id}),resolve:a,reject:l}})}).then(function(t){if(t.caseMaterial.length>0){for(var a=[],l=0;l<t.caseMaterial.length;l+=1)a.push(t.caseMaterial[l].attachmentId);a.length>0&&e({type:"caseform/fetchAttachMent",payload:a})}}),a.setState({visible:!0})},a.handleOk=function(){a.setState({visible:!1})},a.handleCancel=function(){a.setState({visible:!1})},a.showConfirm=function(){var e=a.props.dispatch,t=a.state.selectedRows,l="\u60a8\u5c06\u5220\u9664\u5b9e\u9a8c\u7f16\u53f7\u4e3a   ",n="    \u7684\u6570\u636e\uff01",r=t.map(function(e){return e.caseNo}),d=l+r+n,u=t.map(function(e){return e.id}),s=(0,f.default)((0,f.default)(a));t&&Z({title:"\u786e\u5b9a\u8981\u5220\u9664\u6570\u636e\u5417?",content:d,onOk:function(){new Promise(function(t,a){e({type:"casedemo/remove",payload:{ids:u,resolve:t,reject:a}})}).then(function(e){!0===e&&s.handleSearchs()}),o.default.success("\u5220\u9664\u6210\u529f"),s.setState({selectedRows:[]})},onCancel:function(){}})},a.showConfirms=function(){for(var e=a.props.dispatch,t=a.state.selectedRows,l="\u60a8\u5c06\u5ba1\u6838\u901a\u8fc7\u5b9e\u9a8c\u7f16\u53f7\u4e3a   ",n="    \u7684\u6570\u636e\uff01",r=[],d=[],u=t.map(function(e){return e.status}),s=t.map(function(e){return e.caseNo}),i=t.map(function(e){return e.id}),c=0;c<u.length;c+=1)parseInt(u[c],10)===parseInt(1,10)&&(r.push(s[c]),d.push(i[c]));var m=l+r+n,p=(0,f.default)((0,f.default)(a));t&&Z({title:"\u786e\u5b9a\u8981\u5ba1\u6838\u901a\u8fc7\u5417?",content:m,onOk:function(){new Promise(function(t,a){e({type:"casedemo/updateAudit",payload:{ids:d,status:parseInt(3,10),resolve:t,reject:a}})}).then(function(e){!0===e&&p.handleSearchs()}),o.default.success("\u5ba1\u6838\u6210\u529f"),p.setState({selectedRows:[]})},onCancel:function(){}})},a.handleUpdateModalVisible=function(e,t){a.setState({updateModalVisible:!!e,stepFormValues:t||{}})},a.handleAdd=function(e){var t=a.props.dispatch;t({type:"casedemo/add",payload:{desc:e.desc}}),o.default.success("\u6dfb\u52a0\u6210\u529f"),a.handleModalVisible()},a.handleUpdate=function(e){var t=a.props.dispatch;t({type:"casedemo/update",payload:(0,h.default)({},e,{key:e.key})}),o.default.success("\u66f4\u65b0\u6210\u529f"),a.handleUpdateModalVisible()},a}return(0,b.default)(t,e),(0,E.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e({type:"casedemo/fetch"}),e({type:"casedemo/caseStates"}),e({type:"Entrust/fetchCategorys"})}},{key:"setModal1Visible",value:function(e){this.setState({modal1Visible:e})}},{key:"setModal2Visible",value:function(e){this.setState({modal2Visible:e})}},{key:"handleModal2Ok",value:function(){for(var e=this,t=this.props,a=t.dispatch,l=t.form,n=this.state.selectedRows,r=[],d=n.map(function(e){return e.status}),u=n.map(function(e){return e.id}),s=0;s<d.length;s+=1)parseInt(d[s],10)===parseInt(1,10)&&r.push(u[s]);l.validateFields(function(t){if(!t){var n=e;l.resetFields(),new Promise(function(e,t){a({type:"casedemo/updateAudit",payload:{ids:r,status:parseInt(2,10),resolve:e,reject:t}})}).then(function(e){!0===e&&n.handleSearchs()}),e.setModal2Visible(!1),o.default.success("\u64cd\u4f5c\u6210\u529f"),n.setState({selectedRows:[]})}})}},{key:"renderSimpleForm",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.Entrust.Category;return O.default.createElement(D.default,{onSubmit:this.handleSearch,layout:"inline"},O.default.createElement(m.default,{gutter:{md:8,lg:24,xl:48}},O.default.createElement(p.default,{md:8,sm:24},O.default.createElement(q,{label:"\u6848\u4f8b\u7f16\u53f7"},t("caseNo")(O.default.createElement(M.default,{placeholder:"\u8bf7\u8f93\u5165\u6848\u4f8b\u7f16\u53f7"})))),O.default.createElement(p.default,{md:8,sm:24},O.default.createElement(q,{label:"\u4e13\u4e1a\u7c7b\u522b"},t("caseCategoryId")(O.default.createElement(C.default,{placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},a.map(function(e){return O.default.createElement(J,{key:e.id,value:e.id},e.value)}))))),O.default.createElement(p.default,{md:8,sm:24},O.default.createElement("span",{className:Y.default.submitButtons},O.default.createElement(c.default,{type:"primary",htmlType:"submit"},"\u67e5\u8be2"),O.default.createElement(c.default,{style:{marginLeft:8},onClick:this.handleFormReset},"\u91cd\u7f6e"),O.default.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"\u5c55\u5f00 ",O.default.createElement(i.default,{type:"down"}))))))}},{key:"renderAdvancedForm",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.casedemo.caseState,l=e.Entrust.Category;return O.default.createElement(D.default,{onSubmit:this.handleSearch,layout:"inline"},O.default.createElement(m.default,{gutter:{md:8,lg:24,xl:48}},O.default.createElement(p.default,{md:8,sm:24},O.default.createElement(q,{label:"\u6848\u4f8b\u7f16\u53f7"},t("caseNo")(O.default.createElement(M.default,{placeholder:"\u8bf7\u8f93\u5165\u6848\u4f8b\u7f16\u53f7"})))),O.default.createElement(p.default,{md:8,sm:24},O.default.createElement(q,{label:"\u4e13\u4e1a\u7c7b\u522b"},t("caseCategoryId")(O.default.createElement(C.default,{placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},l.map(function(e){return O.default.createElement(J,{key:e.id,value:e.id},e.value)}))))),O.default.createElement(p.default,{md:8,sm:24},O.default.createElement(q,{label:"\u53d7\u7406\u65e5\u671f"},t("acceptDate")(O.default.createElement(s.default,{style:{width:"100%"}})))),O.default.createElement(p.default,{md:8,sm:24},O.default.createElement(q,{label:"\u59d4\u6258\u4eba",style:{marginLeft:12}},t("clientName")(O.default.createElement(M.default,{placeholder:"\u8bf7\u8f93\u5165\u59d4\u6258\u4eba\u59d3\u540d"})))),O.default.createElement(p.default,{md:8,sm:24},O.default.createElement(q,{label:"\u6848\u4ef6\u72b6\u6001"},t("status")(O.default.createElement(C.default,{allowClear:!0,placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},a.map(function(e){return O.default.createElement(J,{key:e.id,value:e.id},e.value)})))))),O.default.createElement("div",{style:{overflow:"hidden"}},O.default.createElement("div",{style:{float:"right",marginBottom:24}},O.default.createElement(c.default,{type:"primary",htmlType:"submit"},"\u67e5\u8be2"),O.default.createElement(c.default,{style:{marginLeft:8},onClick:this.handleFormReset},"\u91cd\u7f6e"),O.default.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"\u6536\u8d77 ",O.default.createElement(i.default,{type:"up"})))))}},{key:"renderForm",value:function(){var e=this.state.expandForm;return e?this.renderAdvancedForm():this.renderSimpleForm()}},{key:"render",value:function(){for(var e=this,t=this.props,a=t.form.getFieldDecorator,l=t.casedemo,n=l.data,s=l.caseState,i=l.caseMater,o=t.caseform.attachmentList,f=t.loading,h=t.Entrust.Category,v=this.state,E=v.selectedRows,y=v.updateModalVisible,g=v.stepFormValues,b=v.stepDirection,w=v.modal1Visible,k=v.modal2Visible,C=v.visible,M=[],I=[],F=E.map(function(e){return e.status}),x=E.map(function(e){return e.caseNo}),R=E.map(function(e){return e.id}),N=0;N<F.length;N+=1)parseInt(F[N],10)===parseInt(1,10)&&(M.push(x[N]),I.push(R[N]));var j=E.map(function(e){return e.caseNo}),L=parseInt(E.map(function(e){return e.status}),10),q=0;0!==L&&1!==L&&2!==L||(q=parseInt(0,10)),L>2&&L<7&&(q=parseInt(1,10)),L>6&&L<9&&(q=parseInt(2,10)),9===L&&(q=parseInt(3,10)),L>9&&(q=parseInt(4,10));var J={handleUpdateModalVisible:this.handleUpdateModalVisible,handleUpdate:this.handleUpdate},Z=[{title:"\u6848\u4f8b\u7f16\u53f7",dataIndex:"caseNo",align:"center",render:function(t,a){return O.default.createElement(O.Fragment,null,O.default.createElement("a",{onClick:function(){return e.handJump(a)}},a.caseNo))}},{title:"\u4e13\u4e1a\u7c7b\u522b",dataIndex:"caseCategoryId",align:"center",render:function(e){var t=h.filter(function(t){return parseInt(t.id,10)===parseInt(e,10)});return t.length>0?t[0].value:e}},{title:"\u53d7\u7406\u65e5\u671f",dataIndex:"acceptDate",align:"center",render:function(e){return null!==e?O.default.createElement("span",null,(0,z.default)(e).format("YYYY-MM-DD")):e}},{title:"\u59d4\u6258\u65b9",dataIndex:"clientName",align:"center"},{title:"\u6848\u4ef6\u72b6\u6001",dataIndex:"status",align:"center",render:function(e){var t=s.filter(function(t){return parseInt(t.id,10)===parseInt(e,10)}),a=t.length>0?t[0].value:e;return a}},{title:"\u91d1\u989d",dataIndex:"totalPrice",align:"center"},{title:"\u5907\u6ce8",dataIndex:"remark",align:"center"}];return O.default.createElement(U.default,{title:"\u6848\u4ef6\u5ba1\u6838"},O.default.createElement(u.default,{bordered:!1},O.default.createElement("div",{className:Y.default.tableList},O.default.createElement("div",{className:Y.default.tableListForm},this.renderForm()),O.default.createElement("div",{className:Y.default.tableListOperator},O.default.createElement("span",null,O.default.createElement(c.default,{onClick:this.showConfirms,type:"primary",disabled:0===E.length||0===E.filter(function(e){return 1===parseInt(e.status,10)}).length},"\u5ba1\u6838\u901a\u8fc7"),O.default.createElement(c.default,{onClick:function(){return e.setModal2Visible(!0)},type:"danger",disabled:0===E.length||0===E.filter(function(e){return 1===parseInt(e.status,10)}).length},"\u5ba1\u6838\u4e0d\u901a\u8fc7"),O.default.createElement(c.default,{type:"danger",disabled:0===E.length,onClick:this.showConfirm},"\u5220\u9664"),O.default.createElement(c.default,{disabled:1!==E.length,onClick:this.showModal},"\u9274\u5b9a\u6750\u6599"),O.default.createElement(c.default,{disabled:1!==E.length,onClick:function(){return e.setModal1Visible(!0)}},"\u72b6\u6001\u8bb0\u5f55"))),O.default.createElement(S.default,{width:700,title:"\u7f16\u53f7\u4e3a: ".concat(j," \u7684\u9274\u5b9a\u6750\u6599\u8be6\u60c5"),visible:C,onOk:this.handleOk,onCancel:this.handleCancel},function(){if(void 0===i.caseMaterial)return O.default.createElement("span",null,"\u6682\u65e0\u6570\u636e");if(0===i.caseMaterial.length)return O.default.createElement("span",null,"\u6682\u65e0\u6570\u636e");if(i.caseMaterial.length>0){var e=function(){for(var e=i.caseMaterial,t=[],a=function(a){var l=e[a].attachmentId,n=o.filter(function(t){return t.id===e[a].attachmentId}),r=n.length>0?n[0].fileName:l;t.push(O.default.createElement(P.default,{key:e[a].id,size:"large",title:"\u9274\u5b9a\u6750\u6599 ".concat(a+1," "),style:{marginBottom:32}},O.default.createElement(T,{term:"\u9001\u68c0\u6750\u6599\u540d\u79f0"},e[a].name),O.default.createElement(T,{term:"\u7c7b\u578b"},e[a].type),O.default.createElement(T,{term:"\u6570\u91cf"},e[a].amount),O.default.createElement(T,{term:"\u89c4\u683c"},e[a].specification),O.default.createElement(T,{term:"\u6750\u6599\u6027\u8d28"},e[a].feature),O.default.createElement(T,{term:"\u5907\u6ce8"},e[a].remark),O.default.createElement(T,{term:"\u6587\u4ef6"},r),O.default.createElement(d.default,null,O.default.createElement("a",{href:"/spbbase-attachment-web/api/attachment/{id}/download?id=".concat(l)},"\u4e0b\u8f7d"))))},l=0;l<e.length;l+=1)a(l);return{v:O.default.createElement(u.default,null,t)}}();if("object"===typeof e)return e.v}}()),O.default.createElement(S.default,{width:900,title:"\u7f16\u53f7\u4e3a: ".concat(j," \u7684\u72b6\u6001\u8bb0\u5f55"),visible:w,onOk:function(){return e.setModal1Visible(!1)},onCancel:function(){return e.setModal1Visible(!1)},footer:null},O.default.createElement(V.default,{direction:b,progressDot:X,current:q},O.default.createElement(K,{title:"\u6848\u4f8b\u767b\u8bb0"}),O.default.createElement(K,{title:"\u5b9e\u9a8c\u4e2d"}),O.default.createElement(K,{title:"\u51fa\u62a5\u544a"}),O.default.createElement(K,{title:"\u90ae\u5bc4"}),O.default.createElement(K,{title:"\u5b8c\u6210"}))),O.default.createElement(S.default,{width:700,title:"\u7f16\u53f7\u4e3a: ".concat(M," \u7684\u5ba1\u6838\u4e0d\u901a\u8fc7\u539f\u56e0"),centered:!0,visible:k,onOk:function(){return e.handleModal2Ok()},onCancel:function(){return e.setModal2Visible(!1)}},O.default.createElement(m.default,{gutter:16},O.default.createElement(p.default,{lg:24,md:24,sm:24},O.default.createElement(D.default.Item,null,a("Reasons",{rules:[{required:!1,message:"\u8bf7\u5199\u5165\u539f\u56e0"}]})(O.default.createElement(B,{disabled:!0,placeholder:"\u6570\u636e\u6807\u672c\u4e0d\u5b8c\u6574\uff0c\u65e0\u6cd5\u8fdb\u884c\u68c0\u6d4b",autosize:{minRows:4,maxRows:8}})))))),O.default.createElement(A.default,{rowKey:"id",selectedRows:E,loading:f,data:n,columns:Z,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange}))),g&&Object.keys(g).length?O.default.createElement(_,(0,r.default)({},J,{updateModalVisible:y,values:g})):null)}}]),t}(O.PureComponent))||N)||N),G=W;t.default=G}}]);