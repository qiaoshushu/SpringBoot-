(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[61],{"6Bh2":function(e,t,a){e.exports={searchForm:"antd-pro\\pages\\-spb-base\\-district\\-district-searchForm",tableListOperator:"antd-pro\\pages\\-spb-base\\-district\\-district-tableListOperator"}},"V+Xu":function(e,t,a){"use strict";var l=a("xK3H"),r=a("3rQ3");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fhlT");var n=l(a("kXZy")),d=l(a("aG3W"));a("Ktq0");var i=l(a("fL5V"));a("XNft");var o=l(a("Hayk"));a("/26P");var c=l(a("aYvq"));a("Lzml");var u=l(a("vpm+"));a("mKhK");var s=l(a("iW5v")),f=l(a("dnxz")),p=l(a("SeLb")),m=l(a("Sx57")),h=l(a("4zp0")),v=l(a("iVWQ")),y=l(a("lF+r")),g=l(a("PApH")),E=l(a("+S5U"));a("E2ON");var C=l(a("jjSt"));a("Q3sr");var k=l(a("9NP+"));a("XFd2");var b=l(a("33fr"));a("49Cq");var w=l(a("/OG3"));a("/MhY");var D,S,x,R,F,M,O,V=l(a("w0+5")),N=r(a("zLBQ")),T=a("LneV"),L=l(a("zHco")),A=l(a("CkN6")),I=l(a("6Bh2")),B=V.default.TextArea,P=w.default.Group,q=b.default.confirm,J=k.default.Item,_=(C.default.Option,N.default.createContext()),j=function(e){var t=e.form,a=(e.index,(0,E.default)(e,["form","index"]));return N.default.createElement(_.Provider,{value:t},N.default.createElement("tr",a))},z=k.default.create()(j),K=function(e){function t(){var e,a;(0,m.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,v.default)(this,(e=(0,y.default)(t)).call.apply(e,[this].concat(r))),a.state={editing:!1},a.toggleEdit=function(){var e=!a.state.editing;a.setState({editing:e},function(){e&&a.input.focus()})},a.handleClickOutside=function(e){var t=a.state.editing;t&&a.cell!==e.target&&!a.cell.contains(e.target)&&a.save()},a.save=function(){var e=a.props,t=e.record,l=e.handleSave;a.form.validateFields(function(e,r){e||(a.toggleEdit(),l((0,p.default)({},t,r)))})},a}return(0,g.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){this.props.editable&&document.addEventListener("click",this.handleClickOutside,!0)}},{key:"componentWillUnmount",value:function(){this.props.editable&&document.removeEventListener("click",this.handleClickOutside,!0)}},{key:"render",value:function(){var e=this,t=this.state.editing,a=this.props,l=a.editable,r=a.dataIndex,n=a.title,d=a.record,i=(a.index,a.handleSave,(0,E.default)(a,["editable","dataIndex","title","record","index","handleSave"]));return N.default.createElement("td",(0,f.default)({ref:function(t){return e.cell=t}},i),l?N.default.createElement(_.Consumer,null,function(a){return e.form=a,t?N.default.createElement(J,{style:{margin:0}},a.getFieldDecorator(r,{rules:[{required:!0,message:"".concat(n," is required.")}],initialValue:d[r]})(N.default.createElement(V.default,{ref:function(t){return e.input=t},onPressEnter:e.save}))):N.default.createElement("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:e.toggleEdit},i.children)}):i.children)}}]),t}(N.default.Component),H=(D=k.default.create(),D(S=function(e){function t(){var e,a;(0,m.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,v.default)(this,(e=(0,y.default)(t)).call.apply(e,[this].concat(r))),a.selectDistrict=function(){var e=a.props,t=e.form,l=e.handleSearch;t.validateFields(function(e,t){if(!e){var r={code:t.select_code,name:t.select_name};a.setState(function(){l(r)})}})},a.handleFormReset=function(){var e=a.props,t=e.form,l=e.handleFormReset;t.resetFields(),a.setState(function(){l()})},a}return(0,g.default)(t,e),(0,h.default)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return N.default.createElement(k.default,{layout:"inline",className:I.default.searchForm},N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:8,sm:24},N.default.createElement(J,{label:"\u533a\u57df\u4ee3\u7801"},e("select_code")(N.default.createElement(V.default,{placeholder:"\u8bf7\u8f93\u5165\u533a\u57df\u4ee3\u7801"})))),N.default.createElement(s.default,{md:8,sm:24},N.default.createElement(J,{label:"\u533a\u57df\u540d\u79f0"},e("select_name")(N.default.createElement(V.default,{placeholder:"\u8bf7\u8f93\u5165\u533a\u57df\u540d\u79f0"})))),N.default.createElement(s.default,{md:6,sm:24},N.default.createElement("div",{style:{float:"right",marginBottom:24,paddingRight:16}},N.default.createElement(u.default,{type:"primary",onClick:this.selectDistrict},"\u67e5\u8be2"),N.default.createElement(u.default,{style:{marginLeft:8},onClick:this.handleFormReset},"\u91cd\u7f6e")))))}}]),t}(N.PureComponent))||S),Q=(x=k.default.create(),x(R=function(e){function t(){var e,a;(0,m.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,v.default)(this,(e=(0,y.default)(t)).call.apply(e,[this].concat(r))),a.onOk=function(){var e=a.props,t=e.form,l=e.handleOk;t.validateFields(function(e,r){if(!e){var n=(0,p.default)({},r);a.setState(function(){l(n)}),t.resetFields()}})},a.onCancel=function(){var e=a.props,t=e.form,l=e.handleCancel;a.setState(function(){l()}),t.resetFields()},a.onchange=function(e,t){var l=a.props.onchange;a.setState(function(){l(t[t.length-1])})},a.loadData=function(e){var t=a.props.loadData;a.setState(function(){t(e[e.length-1])})},a.check=function(e,t,l){var r=a.props,n=r.dispatch,d=r.action;new Promise(function(e,a){n({type:"DistrictModel/checkCode",payload:{code:t,resolve:e,reject:a}})}).then(function(e){0!==t.length?(/^\d{1,}$/.test(t)||l("\u8bf7\u8f93\u5165\u6570\u5b57"),0!=e.length&&"\u4fee\u6539"!==d&&l("\u8be5\u5730\u533a\u7f16\u7801\u5df2\u5b58\u5728")):l("\u8be5\u9879\u4e0d\u53ef\u4e3a\u7a7a"),l()})},a}return(0,g.default)(t,e),(0,h.default)(t,[{key:"render",value:function(){var e=this.props,t=e.form,a=e.areaModalVisible,l=e.action,r=e.selectRow,n=e.data,d=this.props.buildTreeTest,i=[];for(var u in n)3!==n[u].type&&i.push(n[u]);for(var f in i)2!==i[f].type&&(i[f].key=i[f].code,i[f].isLeaf=!i[f].treeLeaf);var p=d(JSON.stringify(i));return N.default.createElement(b.default,{changeOnSelect:!0,title:l+"\u5730\u533a\u4fe1\u606f",visible:a,onOk:this.onOk,onCancel:this.onCancel},N.default.createElement(k.default,{layout:"inline",className:I.default.searchForm},N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:23,sm:24},N.default.createElement(J,{label:"\u4e0a\u7ea7\u533a\u57df"},t.getFieldDecorator("selectTreeNames",{initialValue:r.selectTreeNames})(N.default.createElement(o.default,{options:p,changeOnSelect:!0,fieldNames:{label:"name",value:"code",children:"children"},disabled:1===r.isEdit,onChange:this.onchange,loadData:this.loadData,placeholder:"\u4e0a\u7ea7\u533a\u57df"}))))),N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:23,sm:24},t.getFieldDecorator("isEdit",{initialValue:1===r.isEdit})(N.default.createElement(V.default,{type:"hidden"})),t.getFieldDecorator("parentCode",{initialValue:r.parentCode})(N.default.createElement(V.default,{type:"hidden"})))),N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:23,sm:24},N.default.createElement(J,{label:"\u533a\u5212\u4ee3\u7801"},t.getFieldDecorator("code",{validateTrigger:"onBlur",validateFirst:!0,initialValue:r.code,rules:[{validator:this.check}]})(N.default.createElement(V.default,{disabled:1===r.isEdit,placeholder:"\u884c\u653f\u533a\u5212\u4ee3\u7801"}))))),N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:23,sm:24},N.default.createElement(J,{label:"\u533a\u57df\u540d\u79f0"},t.getFieldDecorator("name",{initialValue:r.name,rules:[{required:!0,message:"\u8be5\u9879\u4e0d\u53ef\u4e3a\u7a7a"}]})(N.default.createElement(V.default,{placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0"}))))),N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:23,sm:24},N.default.createElement(J,{label:"\u533a\u57df\u7c7b\u578b"},t.getFieldDecorator("type",{initialValue:r.type})(N.default.createElement(P,{disabled:!0,placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"},allowClear:!0},N.default.createElement(w.default,{key:1,value:1},"\u7701"),N.default.createElement(w.default,{key:2,value:2},"\u5e02"),N.default.createElement(w.default,{key:3,value:3},"\u533a")))))),N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:23,sm:24},N.default.createElement(J,{label:"\u6392\u5e8f\u53f7"},t.getFieldDecorator("treeSort",{initialValue:r.treeSort,rules:[{required:!0,message:"\u8be5\u9879\u4e0d\u53ef\u4e3a\u7a7a"}]})(N.default.createElement(V.default,{placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0"}))))),N.default.createElement(c.default,{gutter:{md:8,lg:24,xl:48}},N.default.createElement(s.default,{md:23,sm:24},N.default.createElement(J,{label:"\u533a\u57df\u5907\u6ce8"},t.getFieldDecorator("remark",{initialValue:r.remark})(N.default.createElement(B,{rows:4,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8"})))))))}}]),t}(N.PureComponent))||R),W=(F=(0,T.connect)(function(e){var t=e.DistrictModel,a=e.loading;return{DistrictModel:t,loading:a.models.DistrictModel}}),M=k.default.create(),F(O=M(O=function(e){function t(){var e,a;(0,m.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,v.default)(this,(e=(0,y.default)(t)).call.apply(e,[this].concat(r))),a.state={selectRow:{},selectedRows:[],formValues:{},areaModalVisible:!1,action:"",isRepetitive:""},a.handleSearch=function(e){var t=a.props.dispatch,l={code:""===e.code?void 0:e.code,name:""===e.name?void 0:e.name};void 0===l.code&&void 0===l.name?t({type:"DistrictModel/getDistrict",payload:{parentCode:0}}):t({type:"DistrictModel/getDistrict",payload:l})},a.handleFormReset=function(){var e=a.props,t=e.form,l=e.dispatch;t.resetFields(),l({type:"DistrictModel/getDistrict",payload:{parentCode:0}}),a.setState({formValues:{}})},a.showAreaModal=function(e,t){var l=a.state.selectedRows;if("\u4fee\u6539"===t){var r=l[0].treeNames.split("/");r.pop();var n=l[0].parentCodes.split(",");n.shift();var d=(0,p.default)({},l[0],{selectTreeNames:n,treeNames:r.join("/"),isEdit:1});a.setState({action:t,selectRow:d})}if("\u6dfb\u52a0\u4e0b\u7ea7"===t){var i=l[0].parentCodes+","+l[0].code,o=i.split(",");o.shift();var c={selectTreeNames:o,treeNames:l[0].treeNames,type:l[0].type+1,parentCode:l[0].code};a.setState({selectRow:c})}if("\u65b0\u589e\u7701\u7ea7"===t){var u={type:1};a.setState({selectRow:u})}a.setState({areaModalVisible:!0})},a.handleOk=function(e){var t=a.props.dispatch;e.isEdit?t({type:"DistrictModel/updateDistrictByCode",payload:(0,p.default)({},e)}):t({type:"DistrictModel/addDistrict",payload:(0,p.default)({},e)}),a.setState({selectRow:{},areaModalVisible:!1})},a.handleCancel=function(){a.setState({areaModalVisible:!1,selectRow:[]})},a.remove=function(){var e=a.props.dispatch,t=a.state.selectedRows;if(!1!==t[0].treeLeaf){var l=t[0].name;q({title:l+"\u4e0b\u6709\u5176\u4ed6\u5730\u533a\uff0c\u4e0d\u53ef\u76f4\u63a5\u5220\u9664",onOk:function(){},onCancel:function(){}})}else q({title:"\u786e\u5b9a\u5220\u9664\u8be5\u533a\u57df?",onOk:function(){var a=t.map(function(e){return e.code});e({type:"DistrictModel/removeBatch",payload:a}),i.default.success("\u5220\u9664\u6210\u529f")},onCancel:function(){}})},a.forceDelete=function(){var e=a.props.dispatch,t=a.state.selectedRows,l=t.map(function(e){return e.code});q({title:"\u786e\u5b9a\u8981\u5220\u9664\u8be5\u533a\u57df\u53ca\u5176\u4e0b\u7ea7\u533a\u57df?",onOk:function(){e({type:"DistrictModel/forceDelete",payload:l}),i.default.success("\u5220\u9664\u6210\u529f")},onCancel:function(){}})},a.onExpand=function(e,t){var l=a.props.dispatch;e&&l({type:"DistrictModel/selectDistrictChilendByCode",payload:{parentCode:t.code}})},a.loadData=function(e){var t=a.props.dispatch;1==e.type&&t({type:"DistrictModel/selectDistrictChilendByCode",payload:{parentCode:e.code}})},a.onchange=function(e){null==e?a.setState({selectRow:{type:1}}):a.setState({selectRow:{type:e.type+1,parentCode:e.code}})},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a}return(0,g.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e({type:"DistrictModel/getDistrict",payload:{parentCode:0}})}},{key:"buildTree",value:function(e,t){if(null!=e){var a=(0,d.default)(Array.from(new Set(JSON.parse(e)))),l={},r=[];for(var n in a)!0===a[n].treeLeaf&&(a[n].children=new Array),l[a[n].code]=a[n];for(var i in l)l[i].parentCode&&l[l[i].parentCode]?(null===l[l[i].parentCode]||l[l[i].parentCode].children||(l[l[i].parentCode].children=new Array),l[l[i].parentCode].children.push(l[i])):r.push(l[i]);var o={list:r,total:t};return o}}},{key:"buildTreeTest",value:function(e){if(null!=e){var t=(0,d.default)(Array.from(new Set(JSON.parse(e)))),a={},l=[];for(var r in t)a[t[r].code]=t[r];for(var n in a)a[n].parentCode&&a[a[n].parentCode]?(null===a[a[n].parentCode]||a[a[n].parentCode].children||(a[a[n].parentCode].children=new Array),a[a[n].parentCode].children.push(a[n])):l.push(a[n]);return l}}},{key:"render",value:function(){var e=this,t=this.props,a=t.DistrictModel.data,l=t.dispatch,r=this.state,d=r.selectedRows,i=r.areaModalVisible,o=r.action,c=r.selectRow,s=r.isRepetitive;console.log(a);var m=[{dataIndex:1,title:"\u7701"},{dataIndex:2,title:"\u5e02"},{dataIndex:3,title:"\u533a"}],h=[{title:"\u884c\u653f\u533a\u5212\u4ee3\u7801",dataIndex:"code",key:"code",width:"20%"},{title:"\u540d\u79f0",dataIndex:"name",key:"name"},{title:"\u533a\u57df\u7c7b\u578b",dataIndex:"type",key:"type",render:function(e){return m[e-1].title}},{title:"\u6392\u5e8f\u53f7",dataIndex:"treeSort",key:"treeSort",defaultSortOrder:"ascend",sorter:function(e,t){return e.treeSort-t.treeSort},width:"15%",editable:!0},{title:"\u5907\u6ce8",dataIndex:"remark",key:"remark"}],v={handleSearch:this.handleSearch,handleFormReset:this.handleFormReset},y={handleCancel:this.handleCancel,handleOk:this.handleOk,buildTreeTest:this.buildTreeTest,checkCode:this.checkCode,onchange:this.onchange,loadData:this.loadData},g=function(t){var a=e.props.dispatch;a({type:"DistrictModel/updateDistrictByCode",payload:(0,p.default)({},t)}),console.log("row",t)},E={body:{row:z,cell:K}},C=h.map(function(e){return e.editable?(0,p.default)({},e,{onCell:function(t){return{record:t,editable:e.editable,dataIndex:e.dataIndex,title:e.title,handleSave:g}}}):e});return N.default.createElement(L.default,null,N.default.createElement(n.default,null,N.default.createElement(H,v),N.default.createElement("div",{className:I.default.tableListOperator},N.default.createElement(u.default,{type:"primary",disabled:1===d.length&&3===d[0].type,onClick:function(t){return e.showAreaModal(t,1===d.length?"\u6dfb\u52a0\u4e0b\u7ea7":"\u65b0\u589e\u7701\u7ea7")}},1===d.length?"\u6dfb\u52a0\u4e0b\u7ea7":"\u65b0\u589e"),N.default.createElement(u.default,{disabled:1!==d.length,onClick:function(t){return e.showAreaModal(t,"\u4fee\u6539")}},"\u4fee\u6539"),N.default.createElement(u.default,{disabled:!(d.length>0),onClick:this.remove},"\u5220\u9664"),N.default.createElement(u.default,{type:"danger",disabled:!(d.length>0),onClick:this.forceDelete},"\u5f3a\u5236\u5220\u9664"),a&&0!=a.list.length?N.default.createElement(Q,(0,f.default)({},y,{selectRow:c,areaModalVisible:i,action:o,isRepetitive:s,data:a.list,dispatch:l})):null),a&&0!=a.list.length?N.default.createElement(A.default,{rowKey:"code",components:E,selectedRows:d,onExpand:function(t,a){return e.onExpand(t,a)},data:this.buildTree(JSON.stringify(a.list),a.total),columns:C,onSelectRow:this.handleSelectRows}):null))}}]),t}(N.PureComponent))||O)||O),X=W;t.default=X}}]);